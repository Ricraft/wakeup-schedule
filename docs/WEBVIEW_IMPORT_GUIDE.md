# WebView 自动化导入使用指南

## 功能简介

WebView 自动化导入是 WakeUp 课表最强大的功能之一，它允许你直接在程序内登录教务系统，自动提取课表数据，无需手动下载 HTML 文件。

## 使用步骤

### 1. 打开 WebView 导入对话框

在主窗口中，选择菜单：**导入 → 从教务系统导入**

或使用快捷键：`Ctrl+W`（如果已配置）

### 2. 选择教务系统

对话框顶部提供了常用教务系统的快速选择：

- **苏州大学**: http://jwxt.suda.edu.cn/
- **南京大学**: http://elite.nju.edu.cn/
- **东南大学**: http://xk.seu.edu.cn/
- **自定义**: 输入你学校的教务系统网址

### 3. 登录教务系统

1. 在内嵌浏览器中输入用户名和密码
2. 完成验证码（如果有）
3. 点击登录按钮

### 4. 导航到课表页面

登录成功后，找到并点击"课表查询"或类似的菜单项，确保页面显示完整的课表。

### 5. 提取课表

当课表页面完全加载后，点击底部的 **📥 获取课表** 按钮。

程序会自动：
- 提取页面中的课表 HTML
- 解析课程信息（课程名、教师、地点、时间、周次等）
- 验证数据完整性

### 6. 确认导入

如果提取成功，会显示导入的课程数量。点击"确定"后，课程将自动添加到你的课表中。

## 支持的教务系统

### 正方教务系统

本功能主要针对**正方教务系统**（最常见的高校教务系统）进行优化。

特征识别：
- 课表页面通常有 `id="Table1"` 的表格
- 课程信息格式：`课程名 {第X-Y周 教师 地点`
- 支持单双周标记：`{第1-16周(单)` 或 `{第1-16周(双)`

### 其他教务系统

如果你的学校使用其他教务系统，可以尝试以下方法：

1. **手动导出 HTML**：在教务系统中将课表另存为 HTML 文件，然后使用"从 HTML 导入"功能
2. **联系开发者**：提供你学校教务系统的 URL 和课表页面截图，我们可以添加适配器支持

## 常见问题

### Q1: 点击"获取课表"后提示"不是课表页面"

**原因**：当前页面不包含课表数据。

**解决方法**：
- 确保已导航到显示课表的页面
- 检查页面是否完全加载
- 尝试刷新页面

### Q2: 提取的课程数量为 0

**原因**：页面格式不符合预期，或课表为空。

**解决方法**：
- 检查教务系统中是否有课程数据
- 尝试使用"从 HTML 导入"功能手动导入
- 联系开发者报告问题

### Q3: 登录后页面显示不正常

**原因**：某些教务系统使用了特殊的 JavaScript 或 CSS。

**解决方法**：
- 尝试刷新页面
- 使用浏览器导航按钮（后退/前进）
- 如果问题持续，使用外部浏览器下载 HTML 文件后手动导入

### Q4: 无法访问教务系统（校园网限制）

**原因**：某些学校的教务系统只能在校园网内访问。

**解决方法**：
- 连接校园 VPN
- 在校园内使用
- 使用手动导入方式（先在校园网内下载 HTML）

## 技术细节

### JavaScript 注入

程序使用以下 JavaScript 代码提取页面内容：

```javascript
(function() {
    // 优先从 iframe 获取（正方教务系统特征）
    var iframe = document.getElementById('iframeautoheight');
    if (iframe && iframe.contentWindow && iframe.contentWindow.document) {
        return iframe.contentWindow.document.body.innerHTML;
    }
    
    // 如果没有 iframe，返回整个页面
    return document.body.innerHTML;
})();
```

### 数据解析

提取的 HTML 会传递给 `HTMLImporter` 进行解析：

1. 定位 `id="Table1"` 的表格
2. 遍历表格行和列
3. 使用正则表达式提取：
   - 课程名称
   - 教师姓名
   - 上课地点
   - 周次范围（如：1-16周）
   - 单双周标记（如：单、双）
   - 星期和节次

### 数据验证

导入前会进行以下验证：

- 页面是否包含"星期一"、"星期二"等关键字
- 是否成功提取到课程信息
- 课程数据是否完整（课程名、时间等）

## 隐私和安全

### 数据安全

- **本地处理**：所有数据处理都在本地进行，不会上传到任何服务器
- **不保存密码**：程序不会保存你的教务系统密码
- **Cookie 管理**：WebView 的 Cookie 仅在当前会话有效

### 建议

- 使用完毕后关闭 WebView 对话框
- 定期修改教务系统密码
- 不要在公共计算机上保存登录状态

## 更新日志

### v1.0.0 (2024-12-31)

- ✨ 首次发布 WebView 自动化导入功能
- 🎯 支持正方教务系统
- 🔧 内置苏州大学、南京大学、东南大学等常用 URL
- 🌐 支持自定义教务系统 URL
- 📱 提供完整的浏览器导航功能（前进、后退、刷新）
- 🔍 自动检测课表页面
- ✅ 智能解析课程信息

## 反馈和支持

如果你在使用过程中遇到问题，或者希望添加对你学校教务系统的支持，请：

1. 提供教务系统 URL
2. 提供课表页面的 HTML 源代码（可以通过浏览器"查看源代码"获取）
3. 提供课表页面截图

我们会尽快添加支持！

---

**享受自动化导入带来的便利吧！** 🎉
